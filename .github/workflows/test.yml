name: TimesPrime Payment Automation Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * *'  # Run daily at 2 AM UTC

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        java-version: ['21']
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ”§ Set up JDK ${{ matrix.java-version }}
      uses: actions/setup-java@v3
      with:
        java-version: ${{ matrix.java-version }}
        distribution: 'temurin'
        cache: maven
    
    - name: ğŸ“¦ Install dependencies
      run: mvn clean install -DskipTests -q
    
    - name: ğŸ§ª Run all tests
      run: mvn clean test -q
      continue-on-error: true
    
    - name: ğŸ§ª Run UPI Payment Tests
      run: mvn clean test -Dtest=UPIPaymentFlowTest -q
      continue-on-error: true
    
    - name: ğŸ§ª Run Card Payment Tests
      run: mvn clean test -Dtest=CardPaymentFlowTest -q
      continue-on-error: true
    
    - name: ğŸ§ª Run Net Banking Tests
      run: mvn clean test -Dtest=NetBankingPaymentFlowTest -q
      continue-on-error: true
    
    - name: ğŸ§ª Run Wallet & EMI Tests
      run: mvn clean test -Dtest=WalletAndEMIPaymentFlowTest -q
      continue-on-error: true
    
    - name: ğŸ§ª Run End-to-End Tests
      run: mvn clean test -Dtest=EndToEndPaymentFlowTest -q
      continue-on-error: true
    
    - name: ğŸ“Š Generate test report
      run: mvn surefire-report:report -q
      if: always()
    
    - name: ğŸ“ Upload screenshots
      uses: actions/upload-artifact@v3
      if: failure()
      with:
        name: screenshots
        path: screenshots/
    
    - name: ğŸ“ Upload test reports
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-reports
        path: |
          target/surefire-reports/
          target/site/
    
    - name: âœ… Test Summary
      run: |
        echo "## Test Execution Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Java Version: ${{ matrix.java-version }}" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Browser: Chrome (Auto-managed)" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Test Framework: Selenium + TestNG" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Tests: UPI, Card, NetBanking, Wallet, EMI, End-to-End" >> $GITHUB_STEP_SUMMARY

  build:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ”§ Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: maven
    
    - name: ğŸ—ï¸ Build project
      run: mvn clean package -DskipTests -q
    
    - name: ğŸ“¦ Upload build artifact
      uses: actions/upload-artifact@v3
      if: success()
      with:
        name: build-artifact
        path: target/*.jar

  notify:
    runs-on: ubuntu-latest
    needs: [test, build]
    if: always()
    
    steps:
    - name: ğŸ“¢ Print completion message
      run: |
        echo "ğŸ‰ TimesPrime Payment Automation Tests Completed!"
        echo "âœ… Status: ${{ job.status }}"
        echo "ğŸ“Š Workflow: ${{ github.workflow }}"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        echo "ğŸ‘¤ Actor: ${{ github.actor }}"
